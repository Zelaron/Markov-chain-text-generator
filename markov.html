<!DOCTYPE html>
<html>
<head>
  <title>Markov Generator</title>
</head>
<body>

  <h3>Text input:</h3>
  <textarea id="input" rows="10" cols="100">Logic will get you from A to B. Imagination will take you everywhere. Insanity: doing the same thing over and over again and expecting different results. We cannot solve our problems with the same thinking we used when we created them. Learn from yesterday, live for today, hope for tomorrow. The important thing is not to stop questioning. The true sign of intelligence is not knowledge but imagination. Try not to become a man of success, but rather try to become a man of value. The only source of knowledge is experience. When you are courting a nice girl an hour seems like a second. When you sit on a red-hot cinder a second seems like an hour. That's relativity. Only two things are infinite, the universe and human stupidity, and I'm not sure about the former. Once we accept our limits, we go beyond them.</textarea>
  <h3>Text output:</h3>
  <textarea id="output" rows="10" cols="100"></textarea>
  <p><button id="generateBtn">Generate text!</button></p>

<script>
document.getElementById('generateBtn').addEventListener('click', () => {
  const input = document.getElementById('input').value;
  const tokens = input.match(/[\w'â€™]+[:]?|[.,!?;]+/g);
  if (!tokens) return;

  const chain = tokens.slice(0, -1).reduce((acc, token, i) => {
    const key = token.toLowerCase();
    const next = tokens[i + 1].toLowerCase();
    if (!acc.has(key)) acc.set(key, []);
    acc.get(key).push(next);
    return acc;
  }, new Map());

  const keys = [...chain.keys()];
  let word = keys[Math.floor(Math.random() * keys.length)];
  let result = '';

  for (let i = 0; i < 150; i++) {
    const followers = chain.get(word.toLowerCase());
    if (!followers?.length) break;

    const nextWord = followers[Math.floor(Math.random() * followers.length)];
    result += word + (/\w/.test(nextWord) ? ' ' : '');
    word = nextWord;
  }
  result += word; // Append the final word

  document.getElementById('output').value = result
    .replace(/^./, c => c.toUpperCase()) // Capitalize first letter
    .replace(/([.!?]\s+)([a-z])/g, (_, p1, p2) => p1 + p2.toUpperCase())
    .replace(/\s(i)(?=\s|')/g, ' I') // Capitalize "i" when it's a word
    .trim();
});
</script>
</body>
</html>
